<!DOCTYPE html>




<html class="theme-next pisces" lang="default">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/blog/css/main.css?v=6.0.1" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=6.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=6.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=6.0.1">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=6.0.1" color="#222">





  <meta name="keywords" content="technology, computers, india, travel">










<meta property="og:type" content="website">
<meta property="og:title" content="categories">
<meta property="og:url" content="https://nishil.in/blog/categories/index.html">
<meta property="og:site_name" content="Nishil Kohli">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-04-20T18:41:52.960Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="categories">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Pisces',
    version: '6.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://nishil.in/blog/categories/">





    <title>How to configure nginx with HTTPS redirects and geoip | Nishil Kohli</title>
    









    <!-- Bigfoot footers-->
    <link rel="stylesheet" href="/blog/js/libs/bigfoot/bigfoot-number.css">
        
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Blog | nishil.in</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
    <link href="/blog/js/libs/css/jumbotron-narrow.css" rel="stylesheet">
    <link href="/blog/js/libs/css/style.css" rel="stylesheet">
  </head>

  <body itemscope itemtype="http://schema.org/WebPage" lang="default">
    <div class="container">
      <div class="row header">
        <div class="col-12">
          <ul class="nav nav-pills float-right">
            <li class="nav-item passive"><a class="nav-link active" href="/blog" title="CV">Blog</a></li>
            <li class="nav-item passive"><a class="nav-link" href="/projects" title="Projects">Projects</a></li>
          </ul>
          <h3 class="text-muted"><a href="/">Nishil Kohli</a></h3>
        </div>
      </div> <!-- /header -->
      
      
      
      

    
    
      <main id="main" class="row main ">
        <div class="main-inner col-12">
          <div class="content-wrap">
            <div id="content " class="content">
              

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://nishil.in/blog/blog/how-to-configure-nginx-with-https-redirects-and-geoip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nishil Kohli">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nishil Kohli">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">How to configure nginx with HTTPS redirects and geoip</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-10T19:21:00-08:00">2017-03-10</time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Technology/" itemprop="url" rel="index">
                    <span itemprop="name">Technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>This is mostly for self reference but might help somebody out there.</p>
<h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>I run a couple of sites on <a href="https://www.digitalocean.com/" target="_blank" rel="noopener">Digital Ocean</a> and thought it would be a good idea to have them use HTTPS as it is 2017 and google is <a href="https://motherboard.vice.com/en_us/article/google-will-soon-shame-all-websites-that-are-unencrypted-chrome-https" target="_blank" rel="noopener">pushing</a> for a HTTPS-only web in the future.</p>
<p>My sites are standard node+express and emberjs apps. Running inside their Docker containers with nginx webserver on the front. I wanted to achieve the following - </p>
<ol>
<li>www requests to be rediected to non-www site.</li>
<li>HTTP requests to be redirected to HTTPS</li>
<li>Geo-ip info to be passed to the apps with all requests</li>
<li>Handle all of the above for two separate sites I am hosting on the same server. </li>
</ol>
<p>The first requirement redirects people typing <code>www.mysite.com</code> to <code>mysite.com</code>. This is preferabe because google treats www and non-www as two separate domains.<br>The second requirement forces all connections to use HTTPS. Because what Is the point of having HTTPS configured if you aren’t going to enforce it?<br>I am using geoip info in some of my apps and don’t want to depend on external APIs or run a separate local instance to do the lookups. Much easier to just have the database sitting locally and webserver getting the info even before the request reaches the app.</p>
<h3 id="How-to"><a href="#How-to" class="headerlink" title="How-to"></a>How-to</h3><h4 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h4><ol>
<li>The following config assumes you have your apps running inside their docker containers which either share the docker network with a container running nginx or nginx is running on the host system and is able to communicate to the apps through <a href="https://docs.docker.com/engine/reference/builder/#expose" target="_blank" rel="noopener">exposed ports</a>.</li>
</ol>
<ul>
<li>You need to have your SSL certificates in place before running nginx or it will crash. The SSL certificates need to be valid for both www and non-www domains otherwise redirects will throw up errors. <a href="https://letsencrypt.org/" target="_blank" rel="noopener">Letsencrypt</a> is a good place to start when looking for certificates.</li>
<li>Make sure your instalation of nginx has the geoip module by running <code>nginx -V</code> and looking for <code>--with-http_geoip_module</code></li>
<li>Download and save Maxmind’s city and country <a href="http://dev.maxmind.com/geoip/geoip2/geolite2/" target="_blank" rel="noopener">Geo-ip databases</a>.</li>
</ul>
<h4 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h4><p>After going through DO’s tutorial and a few threads on Stack-overflow this is what I ended up with in my nginx.conf. Look for comments which explain things further  –</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span>  nginx;</span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">error_log</span>  /var/log/nginx/error.log <span class="literal">warn</span>;</span><br><span class="line"><span class="attribute">pid</span>        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Required for Geo-ip to work</span></span><br><span class="line"><span class="attribute">load_module</span> <span class="string">"modules/ngx_http_geoip_module.so"</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># maxmind's country and city IP database</span></span><br><span class="line">    <span class="attribute">geoip_country</span> /etc/nginx/geoip/GeoIP.dat; </span><br><span class="line">    <span class="attribute">geoip_city</span> /etc/nginx/geoip/GeoLiteCity.dat;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span>       /etc/nginx/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                      <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                      <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span>  /dev/stdout  main;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># Listen for non-HTTPS requests and redirect them to HTTPS</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">server_name</span> www.site1.com site1.com;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://site1.com<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Listen for www requests with HTTPS and redirect them to non www site </span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>              <span class="number">443</span> ssl;</span><br><span class="line">        <span class="attribute">server_name</span>         www.site1.com;</span><br><span class="line">        <span class="comment"># path to SSL certificates</span></span><br><span class="line">        <span class="attribute">ssl_certificate</span>     /etc/letsencrypt/live/www.site1.com/fullchain.pem;</span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/www.site1.com/privkey.pem;</span><br><span class="line">        <span class="attribute">ssl_protocols</span>       TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">        <span class="attribute">ssl_ciphers</span>         HIGH:!aNULL:!MD5;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://site1.com<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Listen for non-www HTTPS requests and serve the app</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>              <span class="number">443</span> ssl;</span><br><span class="line">        <span class="attribute">server_name</span>         site1.com;</span><br><span class="line">        <span class="comment"># path to SSL certificates</span></span><br><span class="line">        <span class="attribute">ssl_certificate</span>     /etc/letsencrypt/live/www.site1.com/fullchain.pem;</span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/www.site1.com/privkey.pem;</span><br><span class="line">        <span class="attribute">ssl_protocols</span>       TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">        <span class="attribute">ssl_ciphers</span>         HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span><span class="regexp"> ^~</span> /.well-known/ &#123;</span><br><span class="line">            <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">            <span class="attribute">allow</span> all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="comment"># Set geo-ip headers</span></span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_country_code <span class="variable">$geoip_country_code</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_city <span class="variable">$geoip_city</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_latitude <span class="variable">$geoip_latitude</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_longitude <span class="variable">$geoip_longitude</span>;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://app1:3000;    <span class="comment"># replace 'app1' with 'localhost' if ngix is not running within docker network </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Listen for non-HTTPS requests and redirect them to HTTPS</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">server_name</span> www.site2.com site2.com;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://site2.com<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Listen for www requests with HTTPS and redirect them to non www site</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>              <span class="number">443</span> ssl;</span><br><span class="line">        <span class="attribute">server_name</span>         www.site2.com;</span><br><span class="line">        <span class="attribute">ssl_certificate</span>     /etc/letsencrypt/live/www.site2.com/fullchain.pem;</span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/www.site2.com/privkey.pem;</span><br><span class="line">        <span class="attribute">ssl_protocols</span>       TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">        <span class="attribute">ssl_ciphers</span>         HIGH:!aNULL:!MD5;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://site2.com<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Listen for non-www HTTPS requests and serve the app</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>              <span class="number">443</span> ssl;</span><br><span class="line">        <span class="attribute">server_name</span>         site2.com;</span><br><span class="line">        <span class="attribute">ssl_certificate</span>     /etc/letsencrypt/live/www.site2.com/fullchain.pem;</span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/www.site2.com/privkey.pem;</span><br><span class="line">        <span class="attribute">ssl_protocols</span>       TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">        <span class="attribute">ssl_ciphers</span>         HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span><span class="regexp"> ^~</span> /.well-known/ &#123;</span><br><span class="line">            <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">            <span class="attribute">allow</span> all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="comment"># Set geo-ip headers</span></span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_country_code <span class="variable">$geoip_country_code</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_city <span class="variable">$geoip_city</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_latitude <span class="variable">$geoip_latitude</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> geoip_longitude <span class="variable">$geoip_longitude</span>;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://app2:4200;  <span class="comment"># replace 'app2' with 'localhost' if ngix is not running within docker network   </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/blog/tags/dev-ops/" rel="tag"># dev-ops</a>
          
            <a href="/blog/tags/digital-ocean/" rel="tag"># digital ocean</a>
          
            <a href="/blog/tags/nginx/" rel="tag"># nginx</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/redundant-internet-using-tomato-capable-router/" rel="next" title="Redundant internet using a Tomato capable router">
                <i class="fa fa-chevron-left"></i> Redundant internet using a Tomato capable router
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/joys-of-network-attached-storage/" rel="prev" title="The Joys of Network Attached Storage">
                The Joys of Network Attached Storage <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


            </div>
          </div>
          
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <!--<li class="sidebar-nav-overview" data-target="site-overview-wrap">
            
          </li>-->
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Nishil Kohli</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Background"><span class="nav-number">1.</span> <span class="nav-text">Background</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to"><span class="nav-number">2.</span> <span class="nav-text">How-to</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Prerequisites"><span class="nav-number">2.1.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nginx-conf"><span class="nav-number">2.2.</span> <span class="nav-text">nginx.conf</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


          
        </div>
      </main>
      <div class="row footer">
        <div class="col-12">
          <div class="float-right">
            <a href="/blog/archives">Archive</a> | 
            <a href="/blog/categories">Categories</a> | 
            <a href="/blog/tags">Tags</a>
          </div>
          <h5 class="text-muted">Find me on the Internet</h5>
          <ul class="social">
            <li class="cell cell-6">
              <a href="https://twitter.com/nishilk" class="twitter" rel="me">
                <svg viewbox="0 0 512 512">
                  <path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"/>
                </svg>
                Twitter
              </a>
            </li>
            <li class="cell cell-6">
              <a href="https://github.com/charsi" class="github" rel="me">
                <svg viewbox="0 0 512 512">
                  <path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/>
                </svg>
                GitHub
              </a>
            </li>
            <li class="cell cell-6">
              <a href="https://www.facebook.com/8488307681665f3dc017ebcab0c4cd7b1733e102" class="facebook" rel="me">
                <svg viewbox="0 0 512 512">
                  <path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z"/>
                </svg>
                Facebook
              </a>
            </li>
            <li class="cell cell-6">
              <a href="https://www.instagram.com/ncetbh/" class="instagram" rel="me">
                <svg viewbox="0 0 512 512">
                  <g>
                    <path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"/>
                    <path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"/>
                    <circle cx="351.5" cy="160.5" r="21.5"/>
                  </g>
                </svg>
                Instagram
              </a>
            </li>
            <li class="cell cell-12">
              <a href="https://stackoverflow.com/users/3761234/charsi" class="stackoverflow" rel="me">
                <svg viewbox="0 0 512 512">
                  <path d="M294.8 361.2l-122 0.1 0-26 122-0.1L294.8 361.2zM377.2 213.7L356.4 93.5l-25.7 4.5 20.9 120.2L377.2 213.7zM297.8 301.8l-121.4-11.2 -2.4 25.9 121.4 11.2L297.8 301.8zM305.8 267.8l-117.8-31.7 -6.8 25.2 117.8 31.7L305.8 267.8zM321.2 238l-105-62 -13.2 22.4 105 62L321.2 238zM346.9 219.7l-68.7-100.8 -21.5 14.7 68.7 100.8L346.9 219.7zM315.5 275.5v106.5H155.6V275.5h-20.8v126.9h201.5V275.5H315.5z"/>
                </svg>
                StackOverflow
              </a>
            </li>
          </ul>
        </div>
        <div class="col-sm-8">
          <p><small>&copy; 2018 Nishil Kohli</small></p>
        </div>
      </div>
    </div>
      <!--<footer id="footer" class="footer">
        <div class="footer-inner">
          <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nishil Kohli</span>

  

  
</div>









          







          
        </div>
      </footer>-->    
    


    
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
    </div>
    
    
      
    

    

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


    


  <script type="text/javascript" src="/blog/js/src/utils.js?v=6.0.1"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=6.0.1"></script>



    
    


  <script type="text/javascript" src="/blog/js/src/affix.js?v=6.0.1"></script>

  <script type="text/javascript" src="/blog/js/src/schemes/pisces.js?v=6.0.1"></script>



    
  <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=6.0.1"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=6.0.1"></script>



    


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=6.0.1"></script>



    



	





  





  










    





    

    

    

    
    

    

    

    


    <script type="text/javascript" src="/blog/js/libs/jquery/jquery-3.2.1.slim.min.js"></script>
    
    <!--<script src="/blog/libs/jquery/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
    <!-- Bigfoot footers-->
    <script type="text/javascript" src="/blog/js/libs/bigfoot/bigfoot.min.js"></script>
    <!--<script type="text/javascript" src="/blog/libs/bigfoot/bigfoot.min.js"></script>-->
    <script>
      var bigfoot = $.bigfoot(
          {
          activateOnHover: true
          }
      );
      $.bigfoot();
      </script>
      <script>
      // Creates Captions from Alt tags
      $("div.post-body").children("p").children('img').each(
          function() {
          // Let's put a caption if there is one
          if ($(this).attr("alt")) {
              $(this).wrap(
                  '<figure class="image"></figure>'
              ).after(
                  '<figcaption>' +
                  $(this).attr(
                      "alt") +
                  '</figcaption>'
              );
          }
      });
    </script>
  </body>
</html>
